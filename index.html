<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo - Envases La Econ√≥mica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <style>
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800 pb-20">

    <nav class="bg-indigo-900 text-white sticky top-0 z-30 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="bg-white text-indigo-900 p-2 rounded-lg font-bold text-xl h-10 w-10 flex items-center justify-center">E</div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight">Envases La Econ√≥mica</h1>
                    <p class="text-xs text-indigo-300">Cat√°logo Digital</p>
                </div>
            </div>
            <div class="w-full md:w-96 relative text-slate-600">
                <input type="text" id="searchInput" onkeyup="filterLocalProducts()" placeholder="Buscar envase, botella, tapa..." 
                       class="w-full p-2.5 pl-10 rounded-lg border-none outline-none focus:ring-2 focus:ring-indigo-400 shadow-inner bg-slate-100/90 text-sm">
            </div>
        </div>
    </nav>

    <div class="bg-white border-b border-slate-200 sticky top-[72px] z-20 shadow-sm md:top-[80px]">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div id="categories-container" class="flex gap-2 overflow-x-auto hide-scroll pb-1"></div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div id="products-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
            <div class="col-span-full flex flex-col items-center justify-center py-20 text-slate-400">
                <div class="animate-spin h-10 w-10 border-4 border-indigo-500 border-t-transparent rounded-full mb-4"></div>
                <p>Cargando cat√°logo...</p>
            </div>
        </div>
    </main>

    <div id="toast-notification" class="fixed bottom-24 right-6 z-50 transform transition-all duration-300 translate-y-20 opacity-0 pointer-events-none">
        <div class="bg-slate-800 text-white px-6 py-3 rounded-lg shadow-2xl flex items-center gap-3 border-l-4 border-green-500">
            <span class="text-green-400">‚úì</span>
            <span id="toast-message" class="font-medium text-sm">Agregado</span>
        </div>
    </div>

    <button onclick="toggleCart()" class="fixed bottom-6 right-6 bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-full shadow-2xl z-40 group transition-all active:scale-90 flex items-center justify-center">
        <div class="relative">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white transform scale-0 transition-transform duration-200">0</span>
        </div>
    </button>

    <div id="cart-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="cart-backdrop" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl flex flex-col transform translate-x-full transition-transform duration-300" id="cart-panel">
            
            <div class="p-5 border-b bg-slate-50 flex justify-between items-center">
                <h2 class="text-xl font-bold text-slate-800">Tu Cotizaci√≥n</h2>
                <button onclick="toggleCart()" class="text-slate-400 hover:text-red-500 font-bold text-xl px-2">√ó</button>
            </div>

            <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3 bg-white"></div>

            <div class="p-5 border-t bg-slate-50 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                <div class="flex justify-between items-end mb-4">
                    <span class="text-sm text-slate-500">Total art√≠culos:</span>
                    <span id="cart-total-qty" class="text-2xl font-bold text-indigo-900">0</span>
                </div>
                
                <button onclick="sendCartToWhatsapp()" id="btn-whatsapp-cart" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-green-200 flex items-center justify-center gap-2 transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    Enviar pedido por WhatsApp
                </button>
                <button onclick="clearCart()" class="w-full mt-3 text-xs text-red-400 hover:text-red-600 font-medium tracking-wide uppercase text-center">
                    Vaciar lista completa
                </button>
            </div>
        </div>
    </div>

    <script>
        // === 1. TUS N√öMEROS ===
        const PHONE_1 = "8113728493"; 
        const PHONE_2 = "8118400503"; 

        // === 2. CONFIGURACI√ìN FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyDkQ2HcaLHY7dPvg_IRmuiZNGtcfUhu05o",
            authDomain: "productoseen.firebaseapp.com",
            databaseURL: "https://productoseen-default-rtdb.firebaseio.com",
            projectId: "productoseen",
            storageBucket: "productoseen.firebasestorage.app",
            messagingSenderId: "1052892398028",
            appId: "1:1052892398028:web:055e67f2aa4bce0d9c9d69"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allProducts = [];
        let currentCategory = 'Todos';
        let cart = JSON.parse(localStorage.getItem('cart_een')) || [];

        document.addEventListener('DOMContentLoaded', () => {
            loadProductsFromDB();
            updateCartUI();
        });

        function loadProductsFromDB() {
            const container = document.getElementById('products-container');
            db.ref('productos').on('value', (snapshot) => {
                allProducts = [];
                container.innerHTML = "";
                if (!snapshot.exists()) {
                    container.innerHTML = `<div class="col-span-full text-center py-10 text-slate-400">No hay productos.</div>`;
                    return;
                }
                snapshot.forEach((child) => {
                    const data = child.val();
                    if (data.activo !== false) allProducts.push({ id: child.key, ...data });
                });
                allProducts.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                generateCategoryButtons();
                filterLocalProducts();
            });
        }

        function generateCategoryButtons() {
            const catContainer = document.getElementById('categories-container');
            const categories = ['Todos', ...new Set(allProducts.map(p => p.category || 'Varios'))].sort();
            catContainer.innerHTML = categories.map(cat => `
                <button onclick="setCategory('${cat}')" class="px-5 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all border ${currentCategory === cat ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white text-slate-600 border-slate-200 hover:border-indigo-300 hover:text-indigo-600'}">${cat}</button>
            `).join('');
        }

        function filterLocalProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allProducts.filter(p => {
                const matchesCat = currentCategory === 'Todos' || p.category === currentCategory;
                const matchesSearch = p.name.toLowerCase().includes(searchTerm) || (p.category && p.category.toLowerCase().includes(searchTerm));
                return matchesCat && matchesSearch;
            });
            renderGrid(filtered);
        }

        function setCategory(cat) {
            currentCategory = cat;
            generateCategoryButtons();
            filterLocalProducts();
        }

        function renderGrid(products) {
            const container = document.getElementById('products-container');
            container.innerHTML = "";
            if(products.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-20 text-slate-400">No se encontraron productos.</div>`;
                return;
            }
            products.forEach(p => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-sm hover:shadow-xl border border-slate-100 overflow-hidden flex flex-col transition-all duration-300 group fade-in";
                card.innerHTML = `
                    <div class="h-48 md:h-56 overflow-hidden bg-slate-50 relative">
                        <img src="${p.image}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" onerror="this.src='https://via.placeholder.com/300?text=IMG'">
                        <span class="absolute top-2 right-2 bg-black/60 text-white text-[10px] font-bold px-2 py-1 rounded backdrop-blur-sm uppercase">${p.category || 'General'}</span>
                    </div>
                    <div class="p-4 flex flex-col flex-1">
                        <h3 class="font-bold text-slate-800 text-sm md:text-base leading-snug mb-2 line-clamp-2 min-h-[2.5rem]" title="${p.name}">${p.name}</h3>
                        <div class="mt-auto pt-3 flex gap-2">
                            <button onclick="addToCart('${p.id}')" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-bold text-xs md:text-sm flex items-center justify-center gap-2 transition active:scale-95 shadow-md shadow-indigo-100">Agregar</button>
                            <button onclick="sendSingleMsg('${p.id}')" class="w-10 bg-slate-50 hover:bg-green-50 text-slate-400 hover:text-green-600 border border-slate-200 hover:border-green-200 rounded-lg flex items-center justify-center transition">?</button>
                        </div>
                    </div>`;
                container.appendChild(card);
            });
        }

        function addToCart(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;
            const existing = cart.find(i => i.id === id);
            if (existing) { existing.quantity++; showToast(`Otra unidad agregada`); } 
            else { cart.push({ ...product, quantity: 1 }); showToast(`Agregado`); }
            saveCart();
        }

        function removeFromCart(id) {
            cart = cart.filter(i => i.id !== id);
            saveCart();
        }

        function updateItemQty(id, val) {
            const item = cart.find(i => i.id === id);
            if(!item) return;
            const newQty = parseInt(val);
            if(newQty > 0) { item.quantity = newQty; saveCart(); } else { removeFromCart(id); }
        }

        function clearCart() {
            if(confirm("¬øVaciar lista completa?")) { cart = []; saveCart(); }
        }

        function saveCart() {
            localStorage.setItem('cart_een', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            const countBadge = document.getElementById('cart-count');
            const totalLabel = document.getElementById('cart-total-qty');
            const itemsDiv = document.getElementById('cart-items');
            const btnSend = document.getElementById('btn-whatsapp-cart');
            
            const totalQty = cart.reduce((sum, i) => sum + i.quantity, 0);
            
            countBadge.innerText = totalQty;
            if(totalQty > 0) countBadge.classList.remove('scale-0'); else countBadge.classList.add('scale-0');
            totalLabel.innerText = totalQty;
            
            btnSend.disabled = totalQty === 0;

            itemsDiv.innerHTML = "";
            if(cart.length === 0) {
                itemsDiv.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-slate-300 gap-2"><p class="text-sm">Lista vac√≠a</p></div>`;
                return;
            }

            cart.forEach(item => {
                const el = document.createElement('div');
                el.className = "flex items-center gap-3 bg-slate-50 p-3 rounded-lg border border-slate-200";
                el.innerHTML = `
                    <img src="${item.image}" class="w-12 h-12 object-cover rounded bg-white border">
                    <div class="flex-1 min-w-0">
                        <p class="font-bold text-slate-700 text-xs truncate">${item.name}</p>
                        <p class="text-[10px] text-slate-400 uppercase">${item.category}</p>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <input type="number" min="1" value="${item.quantity}" onchange="updateItemQty('${item.id}', this.value)" class="w-12 p-1 text-center text-xs font-bold bg-white border rounded outline-none focus:border-indigo-500">
                        <button onclick="removeFromCart('${item.id}')" class="text-[10px] text-red-400 hover:text-red-600 underline">Eliminar</button>
                    </div>`;
                itemsDiv.appendChild(el);
            });
        }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            const backdrop = document.getElementById('cart-backdrop');
            const panel = document.getElementById('cart-panel');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => { backdrop.classList.remove('opacity-0'); panel.classList.remove('translate-x-full'); }, 10);
            } else {
                backdrop.classList.add('opacity-0'); panel.classList.add('translate-x-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast-notification');
            document.getElementById('toast-message').innerText = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 2500);
        }

        // FUNCI√ìN OPCI√ìN B: Autom√°tica (Random)
        function sendCartToWhatsapp() {
            if (cart.length === 0) return;
            
            // SELECCI√ìN ALEATORIA ENTRE LOS DOS N√öMEROS
            const randomPhone = Math.random() < 0.5 ? PHONE_1 : PHONE_2;

            let msg = "üëã Hola *Envases La Econ√≥mica*, deseo cotizar este pedido:\n\n";
            cart.forEach(i => msg += `üì¶ *${i.quantity} pzas* ‚Äî ${i.name}\n`);
            msg += `\nüìç *Total Items:* ${cart.reduce((a,b)=>a+b.quantity,0)}\nüìù Quedo en espera. Gracias.`;
            window.open(`https://wa.me/${randomPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function sendSingleMsg(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;
            const randomPhone = Math.random() < 0.5 ? PHONE_1 : PHONE_2;
            const msg = `Hola, me interesa informaci√≥n espec√≠fica sobre: *${product.name}*`;
            window.open(`https://wa.me/${randomPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
